CREATE OR REPLACE FUNCTION ACH_PLAY_5(PLAYER NUMBER)
RETURN NUMBER
IS
CNT NUMBER;
BEGIN
SELECT MATCH_COUNT INTO CNT
FROM PLAYER_TABLE
WHERE PLAYER_ID = PLAYER;

IF CNT >=5 THEN
INSERT INTO PLAYER_ACHIEVEMENT_TABLE VALUES(
PLAYER,
(SELECT ACHIEVEMENT_ID
FROM ACHIEVEMENT_TABLE
WHERE ACHIEVEMENT_GOAL = 'ACH_PLAY_5'));
RETURN 1;
END IF;

RETURN 0;
EXCEPTION
WHEN OTHERS THEN
RETURN 0;

END;
/


CREATE OR REPLACE FUNCTION ACH_WIN_5(PLAYER NUMBER)
RETURN NUMBER
IS
CNT NUMBER;
BEGIN
SELECT WIN_COUNT INTO CNT
FROM PLAYER_TABLE
WHERE PLAYER_ID = PLAYER;

IF CNT>=5 THEN
INSERT INTO PLAYER_ACHIEVEMENT_TABLE VALUES(
PLAYER,
(SELECT ACHIEVEMENT_ID
FROM ACHIEVEMENT_TABLE
WHERE ACHIEVEMENT_GOAL = 'ACH_WIN_5'));
RETURN 1;
END IF;
RETURN 0;

EXCEPTION
WHEN OTHERS THEN
RETURN 0;

END;
/

CREATE OR REPLACE TRIGGER ACH_CHECKER
BEFORE UPDATE ON PLAYER_TABLE
FOR EACH ROW
DECLARE
MX NUMBER;
MI NUMBER;
BEGIN
MX:=ACH_PLAY_5(:NEW.PLAYER_ID);
MI:=ACH_WIN_5(:NEW.PLAYER_ID);
DBMS_OUTPUT.PUT_LINE(MX || '  '||MI);

END;
/

UPDATE PLAYER_TABLE
SET RATING = RATING+1
WHERE PLAYER_ID = 2;

DECLARE
MX NUMBER;
MI NUMBER;
BEGIN
MX:=ACH_PLAY_5(2);
MI:=ACH_WIN_5(2);
DBMS_OUTPUT.PUT_LINE(MX || '  '||MI);

END;
/