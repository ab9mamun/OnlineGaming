CREATE OR REPLACE TRIGGER ON_UPDATE_MATCH
AFTER UPDATE ON MATCH_PARTICIPANTS_TABLE
FOR EACH ROW
DECLARE
POS NUMBER;
MX NUMBER;
MI NUMBER;
BEGIN

UPDATE PLAYER_TABLE
SET MATCH_COUNT = MATCH_COUNT+1
WHERE PLAYER_ID = :NEW.PLAYER_ID;

IF :NEW.POSITION = 1 THEN

UPDATE PLAYER_TABLE
SET RATING = RATING+10
WHERE PLAYER_ID = :NEW.PLAYER_ID;


SELECT BEST_SCORE INTO MX
FROM PLAYER_TABLE
WHERE PLAYER_ID = :NEW.PLAYER_ID;

IF :NEW.SCORE > MX THEN

UPDATE PLAYER_TABLE
SET BEST_SCORE = :NEW.SCORE
WHERE PLAYER_ID = :NEW.PLAYER_ID;
END IF;

UPDATE PLAYER_TABLE
SET WIN_COUNT = WIN_COUNT+1
WHERE PLAYER_ID = :NEW.PLAYER_ID;

MX:=ACH_PLAY_5(:NEW.PLAYER_ID);
MI:=ACH_WIN_5(:NEW.PLAYER_ID);

END IF;

END;
/